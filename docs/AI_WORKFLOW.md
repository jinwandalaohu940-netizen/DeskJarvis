# AI辅助开发工作流指南

> **核心目标**：确保AI辅助开发时保持上下文一致性，避免前后矛盾。

## 🎯 核心策略

### 1. 文档驱动开发（Documentation-Driven Development）

**原则**：所有重要信息都记录在文档中，AI每次对话都引用文档。

**文档体系**：
```
docs/
├── ARCHITECTURE.md    # 架构设计（必须读）
├── DEVELOPMENT.md     # 开发规范（必须读）
├── DECISIONS.md       # 技术决策（必须读）
└── AI_WORKFLOW.md     # 本文档（AI使用指南）
```

### 2. 模块化开发（Modular Development）

**原则**：每个功能独立开发，减少上下文依赖。

**好处**：
- AI只需要关注当前模块
- 模块间通过明确接口通信
- 减少"忘记之前代码"的问题

### 3. 检查点机制（Checkpoint System）

**原则**：每个阶段完成后，更新文档和代码，建立检查点。

---

## 📋 标准工作流程

### 阶段1：规划阶段（Planning）

**目标**：明确要做什么，怎么做

**步骤**：
1. **阅读文档**
   ```
   请先阅读以下文档：
   - docs/ARCHITECTURE.md（了解架构）
   - docs/DEVELOPMENT.md（了解规范）
   - docs/DECISIONS.md（了解已有决策）
   ```

2. **明确需求**
   - 描述要实现的功能
   - 说明输入输出
   - 列出约束条件

3. **技术决策**
   - 如果有新技术选择，先记录在 `DECISIONS.md`
   - 确认是否符合现有架构

4. **创建任务清单**
   - 分解为小任务
   - 每个任务独立可测试

### 阶段2：开发阶段（Development）

**标准提示词模板**：

```
【项目上下文】
我正在开发 DeskJarvis 项目，这是一个AI Agent桌面应用。

【架构约束】
- 前端：Tauri + React + TypeScript
- 后端：Python 3.11+ + Playwright
- AI模型：Claude API
- 通信：Tauri Shell Command调用Python

【当前任务】
[具体描述要实现的功能]

【相关文件】
- [列出相关文件路径]
- [粘贴关键代码片段]

【要求】
1. 遵循 docs/ARCHITECTURE.md 中的架构设计
2. 遵循 docs/DEVELOPMENT.md 中的代码规范
3. 保持与现有代码风格一致
4. 添加完整的错误处理和日志
5. 添加类型提示和docstring

【输出格式】
请提供：
1. 代码实现
2. 说明如何集成到现有代码
3. 需要更新的文档（如有）
```

### 阶段3：集成阶段（Integration）

**步骤**：
1. **代码审查**
   - 检查是否符合架构
   - 检查代码风格是否一致
   - 检查错误处理是否完善

2. **测试**
   - 单元测试
   - 集成测试
   - 手动测试

3. **文档更新**
   - 更新架构文档（如有变更）
   - 更新README（用户可见的功能）
   - 更新决策记录（如有新决策）

### 阶段4：检查点（Checkpoint）

**检查清单**：
- [ ] 代码已提交到Git
- [ ] 文档已更新
- [ ] 测试通过
- [ ] 代码符合规范

---

## 🔧 常见问题处理

### 问题1：AI生成的代码与现有代码不一致

**症状**：
- 代码风格不同
- 架构不符合
- 命名规范不一致

**解决方案**：
1. **停止**：不要直接使用不一致的代码
2. **对比**：对比架构文档和现有代码
3. **修正提示词**：
   ```
   我发现生成的代码与现有代码不一致：
   - [具体问题1]
   - [具体问题2]
   
   请参考以下现有代码风格：
   [粘贴现有代码示例]
   
   请重新生成，保持一致性。
   ```
4. **手动调整**：如果AI无法修正，手动调整

### 问题2：AI忘记了之前的决策

**症状**：
- 建议使用已否决的技术方案
- 架构设计不符合已有决策

**解决方案**：
1. **引用文档**：
   ```
   请参考 docs/DECISIONS.md 中的决策：
   - ADR-002: 使用Shell Command（不是HTTP）
   - ADR-003: 使用Playwright（不是Selenium）
   ```
2. **明确约束**：
   ```
   重要约束：
   - 必须使用Playwright（已在DECISIONS.md中决定）
   - 必须使用Shell Command通信（已在DECISIONS.md中决定）
   ```

### 问题3：AI生成的代码缺少关键功能

**症状**：
- 缺少错误处理
- 缺少日志记录
- 缺少类型提示

**解决方案**：
1. **使用检查清单**：
   ```
   请确保代码包含：
   - [ ] 完整的错误处理
   - [ ] 日志记录（使用logger）
   - [ ] 类型提示（Python/TypeScript）
   - [ ] Docstring（Python函数）
   - [ ] 注释说明复杂逻辑
   ```
2. **分步要求**：
   ```
   请分两步实现：
   第一步：实现核心功能
   第二步：添加错误处理、日志、类型提示
   ```

### 问题4：AI建议改变架构

**症状**：
- 建议使用不同的技术栈
- 建议改变架构设计

**解决方案**：
1. **先记录**：如果建议合理，先记录在 `DECISIONS.md` 作为Proposed
2. **评估**：评估是否真的需要改变
3. **决策**：如果决定改变，更新架构文档
4. **如果不需要改变**：
   ```
   感谢建议，但根据 docs/DECISIONS.md 中的决策，
   我们已经选择了[当前方案]，原因是[原因]。
   请基于现有架构实现。
   ```

---

## 📝 提示词模板库

### 模板1：开始新功能

```
我正在开发 DeskJarvis 的新功能：[功能名]

【项目上下文】
- 架构文档：docs/ARCHITECTURE.md
- 开发规范：docs/DEVELOPMENT.md
- 技术决策：docs/DECISIONS.md

【功能需求】
[详细描述]

【相关文件】
[列出相关文件]

请帮我：
1. 确认是否符合现有架构
2. 设计实现方案
3. 提供代码实现
```

### 模板2：修复Bug

```
我在修复 DeskJarvis 的一个Bug：

【Bug描述】
[详细描述]

【错误信息】
[粘贴错误信息]

【相关代码】
[粘贴相关代码]

【已尝试】
[说明已尝试的解决方案]

请帮我：
1. 分析问题原因
2. 提供修复方案
3. 确保修复不影响其他功能
```

### 模板3：重构代码

```
我需要重构 DeskJarvis 的某个模块：

【当前代码】
[粘贴当前代码]

【问题】
[说明为什么要重构]

【目标】
[重构后的目标]

请帮我：
1. 设计重构方案
2. 确保不破坏现有功能
3. 保持代码风格一致
```

---

## ✅ 质量检查清单

每次完成开发后，检查：

### 代码质量
- [ ] 遵循架构文档
- [ ] 遵循代码规范
- [ ] 有完整的类型提示
- [ ] 有完整的错误处理
- [ ] 有日志记录
- [ ] 有注释和docstring

### 文档质量
- [ ] 架构文档已更新（如有变更）
- [ ] 决策记录已更新（如有新决策）
- [ ] README已更新（用户可见的功能）

### 测试质量
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 手动测试通过

---

## 🚀 快速开始示例

### 示例：添加"下载文件"功能

**步骤1：规划**
```
提示词：
我正在添加"下载文件"功能，请参考 docs/ARCHITECTURE.md，
设计实现方案。
```

**步骤2：开发**
```
提示词：
根据架构文档，请实现 agent/executor/file_downloader.py：
- 使用Playwright下载文件
- 保存到沙盒目录
- 添加错误处理和日志
- 返回文件路径或错误信息
```

**步骤3：集成**
```
提示词：
请将 file_downloader.py 集成到 agent/main.py 中，
确保可以通过Shell Command调用。
```

**步骤4：检查点**
- 代码提交
- 文档更新
- 测试通过

---

## 📚 参考资源

- [Tauri文档](https://tauri.app/)
- [Playwright文档](https://playwright.dev/python/)
- [LangGraph文档](https://langchain-ai.github.io/langgraph/)
- [Claude API文档](https://docs.anthropic.com/)

---

**最后更新**：2025-01-XX  
**维护者**：项目团队
